#+TITLE: Writing technical documents in org-mode
#+AUTHOR: John Kitchin
#+LATEX_CLASS: cmu-article
#+OPTIONS: ^:{}  author:t toc:nil
#+EXPORT_EXCLUDE_TAGS: noexport

\maketitle
\tableofcontents

* Basic principles

Org-mode is a simple, structured markup for information. You should keep it simple. If you find yourself writing a lot of LaTeX, you are probably doing something wrong, or using the wrong tool.


* Basic markup
** Basics
You can mark text as *bold*, /italic/, _underlined_, +struck-through+, =verbatim=, and ~code~.

Paragraphs are separated by blank lines. 

** Subscripts and superscripts

Usually you use ^ for superscripts and _ for subscripts. The things super or subscripted should be in curly brackets. Here are some examples: N_{A} is Avogadro's number. U_{3d} is the U parameter on the 3d orbitals.  You should explicitly mark the content to be super or subscripted with curly brackets. This is controlled by this line:

#+BEGIN_EXAMPLE
#+OPTIONS: ^:{}
#+END_EXAMPLE

** Symbols
Org-mode recognizes many different symbols, including the greek letters, e.g. \alpha, and \Omega. You can make \deg symbol and an \AA symbol. These do not need to be contained in math environments. Some more of my favorites include \times, and  \rightarrow.

** Chemical formulas
You should always enter chemical formulas like this: NH_{3}. No other way is good.  Here are some example formulas: CH_4, ABO_{3-\delta}, FeO^{+1}, H_{2}SO_{4}, Ca(NO_{3})_{2}.

Note this is org syntax /not/ LaTeX syntax. You do not need the math-mode you need in LaTeX. Keep your org syntax clean and do not use math-mode like you do in LaTeX.

** References to document sections

You are safest using a link like this. See section [[*Chemical formulas]]. 

It is possible to create a "label" to a section. You must set a CUSTOM_ID property on the headline. You then refer to that section with this kind of link: see section [[#sec:headline-label]].

#+BEGIN_EXAMPLE
,*** A headline with a custom id property
    :PROPERTIES:
    :CUSTOM_ID: sec:headline-label
#+END_EXAMPLE

*** A headline with a custom id property
    :PROPERTIES:
    :CUSTOM_ID: sec:headline-label
    :END:
This section is intentionally empty.
*** An empty section \label{sec:not-recommended}

If you are used to section labels in LaTeX, you might put the label directly in the heading. This works, but is not recommended because it seems ugly.
Nothing to see here in Section ref:sec:not-recommended. It does work though. For now.

** Line spacing
The default is single spacing. It you want the document to come out double-spaced, use this

#+BEGIN_EXAMPLE
#+LATEX_HEADER: \usepackage{setspace}
\doublespace
#+END_EXAMPLE

* Bibliography and citations
** Specifying the bibliography files where citations come from

You specify the bibtex file(s) you will use with a [[bibliography]] link. This link should be where you want the bibliography to appear in the exported PDF, e.g. usually at the end of the document. Here is what the link looks like. The bibtex file should be in the same directory as your manuscript file.
These links are clickable, and when you click on them, the file under your cursor should be opened.

** Bibliography style
Depending on the type of document you are creating, you may need to specify a bibliography style. Use a [[bibliographystyle]] link for this. Some documents provide their own styles, others require you to specify them. See the examples.

** Citing references
We use cite links to indicate a reference to an entry in the bibliography. Here is an example cite:akhade2012:surface. These links are clickable too. If everything is setup correctly, clicking on the link should open the bibliography at the entry you clicked on. When your cursor is on a link, a tooltip will popup with some details of the citation. If you have sections of your document collapsed, you may see funny stuff in the tooltip.

You can insert citation links by pressing C-c ]. Press enter to accept the default citation type, and then type a few letters to search for what you want. Press enter to get a list of matches. Select the entries you want with m, and then press enter again. The link will be automatically entered. Multiple citations are separated by commas. If you need to add citations to an existing citation, the best thing is to repeat the process just described, and manually delete the extra cite links and join the citations by commas. 



* Equations

There are a few ways to enter equations. If your equation should be inline, e.g. \(e^x = 4\) use this format. 

An alternative format that displays the equation on its own line is this: \[e^x = 4\]

You can also use the older LaTeX markup like this $e^x = 4$ for inline equations, or $$e^x=4$$ for display equations. These notations are more compact, but also more fragile when they are embedded in text.


** References to equations

To make references to equations, you must label them. This can only be done by using a LaTeX equation environment. The label command must go at the end of the equation. Then you can use a ref link like this to refer to Equation ref:eq:1. Note you should write Equation before the link, so it will be clear what you refer to in the exported document.

\begin{equation}
e^x = 4 \label{eq:1}
\end{equation}

The ref link is clickable, and clicking on it moves the cursor to the corresponding label.
* Source code
One of the main reasons to use org-mode is the integration of source code. 

#+BEGIN_SRC python
import matplotlib.pyplot as plt
plt.plot([1,4,7,9])
plt.savefig('fig1.png')
#+END_SRC

#+RESULTS:

By default all blocks will be rendered and included in the exported document. You control this in the source block header. Here is a block that is not exported, nor are the results.

#+BEGIN_SRC python :exports none
print 'hello world'
#+END_SRC

#+RESULTS:
: hello world

* Figures
Figures in org-mode are straightforward. You simply create a link to a figure that Emacs can render, and that can be included in a PDF file. That is usually a png file. You can, and should add captions and labels to the figure. Captions are descriptive, and labels allow you to refer to the figure in your document.


Good practice for the label is prefix it with fig: so that later you can easily spot figure labels from table and equation labels.
#+caption: A descriptive sentence about the figure. 
#+label: fig:test-label
[[./fig1.png]]

The default export behavior is not that nice at setting the width. You can set that the way you want like this:

#+attr_latex: :width 3in :placement [H]
#+caption: A descriptive sentence about the figure. 
#+label: fig:test-label2
[[./fig1.png]]



** References to figures
Later, I can refer to Figure ref:fig:test-label. Figures tend to float around in LaTeX. Do not worry about it.

If you want help inserting the references, type M-x org-insert-ref-link, and press tab. This should show you a list of labels in your document. It only shows labels defined as a link.

** Controlling placement of floats

If it is essential to you to have a float in a specific place, you can set a LaTeX attribute that will probably make that happen. Here is an example.

#+ATTR_LATEX: :placement [H]

** Wrapping text around figures
You may be constrained for space and want your text to wrap around figures. You can use the wrapfig package and some attributes to make this happen. See http://orgmode.org/manual/LaTeX-specific-attributes.html.

#+LATEX_HEADER: \usepackage{wrapfig}

 Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec non elit purus. Maecenas id lectus luctus, ornare libero et, laoreet purus. In placerat, lectus eget rutrum vehicula, tortor odio tempor leo, eu pulvinar dolor ante vitae dui. Vivamus convallis interdum enim gravida molestie. Cras vulputate at neque at mollis. Curabitur lobortis gravida tellus, vitae sagittis nisl tempor ac. Cras vel porta urna. Pellentesque auctor, urna at vehicula rutrum, metus nunc dictum dui, at interdum diam libero vel ipsum. Donec euismod, felis nec dictum mattis, odio lorem tristique orci, in commodo purus nulla sed est. Nam quis molestie mauris. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas.

Fusce bibendum sem turpis, at venenatis magna laoreet in. Sed convallis pretium leo, in aliquam massa lobortis quis. Fusce nec ornare mi. Nulla rutrum, tellus quis pretium varius, neque ligula facilisis urna, sit amet accumsan sem neque sit amet arcu. Aenean augue lacus, sodales a sem vitae, tincidunt rhoncus nibh. Donec venenatis dolor ut nulla bibendum tincidunt. Suspendisse facilisis, eros sed pharetra posuere, sem arcu viverra risus, eu aliquet orci est vitae ipsum. Integer scelerisque nisl et quam dapibus consequat. Integer pretium pharetra nisi, id consectetur dui ultricies ac. Vestibulum fermentum vulputate mauris nec tincidunt. Maecenas velit turpis, tempor porta tincidunt ac, venenatis eget tortor. Duis egestas odio venenatis adipiscing mattis.

#+ATTR_LATEX: :float wrap :width 2in :placement {r}{0.33\textwidth}
#+caption: A wrapped figure that takes up 1/3 of the text, on the right.
[[./fig1.png]]

Mauris placerat faucibus scelerisque. Nunc interdum egestas nunc ut vestibulum. Maecenas commodo justo sit amet scelerisque auctor. Morbi lacinia sem sit amet lectus vehicula porttitor. Pellentesque at dictum metus, quis ornare arcu. Integer tellus turpis, rhoncus nec accumsan in, posuere sit amet arcu. Nullam tempus neque vel condimentum porttitor. Nullam vitae tincidunt felis. Nunc egestas, nunc sit amet tristique adipiscing, ante nulla imperdiet nisi, nec eleifend enim felis et urna. Sed sit amet erat scelerisque, sollicitudin nibh vitae, varius nunc. Mauris posuere scelerisque augue nec placerat. Morbi in elementum risus. Fusce quis condimentum turpis. Sed eleifend libero et diam consectetur, a rhoncus purus porta. Nulla consectetur blandit porta. 


* Tables

Tables are one of org-mode's best features. They are easy to create, and customize. Consider this table:

#+BEGIN_EXAMPLE
#+caption: The simplest kind of table.
#+tblname: tab:example1
| heading1 | heading2 |
|----------+----------|
|        1 |        8 |
|        4 |        5 |
#+END_EXAMPLE

#+caption: The simplest kind of table.
#+tblname: tab:example1
| heading1 | heading2 |
|----------+----------|
|        1 |        8 |
|        4 |        5 |

We use =#+tblname:= to give the table a name we can reference later. Table ref:tab:example1 shows a simple table. We can add vertical lines by setting a LaTeX attribute :align; this attribute also specifies the alignment of each cell. In the next example, we specify vertical lines with |, make the first column centered, and the second column left aligned. You have to put a horizontal line everywhere you want it. We will also specify that the table be placed "Here".

#+BEGIN_EXAMPLE
#+attr_latex: :placement [H] :align | c | l |
#+caption: The second simplest kind of table.
#+tblname: tab:example2
|----------+----------|
| heading1 | heading2 |
|----------+----------|
|        1 |        8 |
|----------+----------|
|        4 |        5 |
|----------+----------|

#+END_EXAMPLE

#+attr_latex: :placement [H] :align | c | l |
#+caption: The second simplest kind of table.
#+tblname: tab:example2
|----------+----------|
| heading1 | heading2 |
|----------+----------|
|        1 |        8 |
|----------+----------|
|        4 |        5 |
|----------+----------|

You can see the result in Table ref:tab:example2.


* Including LaTeX environments
* Miscellaneous document features
** Table of contents
You can add a table of contents with =\tableofcontents=.

This is controlled by this option line:
#+BEGIN_EXAMPLE
#+OPTION: toc:nil
#+END_EXAMPLE
** Preventing export of some headings
You can mark some headings with a tag that is listed in 

#+BEGIN_EXAMPLE
#+EXPORT_EXCLUDE_TAGS: noexport
#+END_EXAMPLE

to mark it for noexport. Put your cursor on the headline, type C-c C-c and type in the tag name. 

*** Heading marked for noexport					   :noexport:

* Exporting to LaTeX and PDF
org-mode is not LaTeX, and it cannot do everything LaTeX does. It can do a lot though. To get LaTeX, we have to provide org-mode with the required packages, and tell it what kind of document to export. The default type is an article. We provide some additional document types:
- cmu-article is like an article, but with one-inch margins

Those types use what we define as the default LaTeX packages to include. These are:
- [AUTO] inputenc
- [T1] fontenc 
- fixltx2e 
- graphicx
- longtable 
- float 
- wrapfig 
- rotating 
- [normalem] ulem 
- amsmath 
- textcomp 
- marvosym 
- wasysym 
- amssymb 
- [version=3] mhchem 
- natbib 
- url 
- minted 
- underscore 	
- [linktocpage,pdfstartview=FitH,colorlinks,linkcolor=blue,anchorcolor=blue,
citecolor=blue,filecolor=blue,menucolor=blue,urlcolor=blue] hyperref
- attachfile

The order of these is important, and changing it can result in LaTeX errors. If you need additional packages for your document, you need to tell org-mode about them like this:

#+BEGIN_EXAMPLE
#+LATEX_HEADER: \usepackage[options]{xyz}
#+END_EXAMPLE

** CMU Qualifier
see [[file:cmu-qualifier/cmu-qualifier.org]]

** CMU MS report
see [[file:cmu-ms-report/project-report.org]]

** ACS journals
The achemso LaTeX package is used. See the documentation here:

 [[../texmf/doc/latex/achemso/achemso.pdf]]
*** I&ECR
see [[./achemso/I&ECR/manuscript.org]]

*** Applied Interfaces and Materials
see [[file:achemso/aamick/manuscript.org]]

*** ACS Catalysis
see [[./achemso/accacs/manuscript.org]]

*** TODO Analytical Chemistry

** APS journals
The revtex4-1 package is used. See the documentation here:

 file:../texmf/doc/latex/revtex/auguide/auguide4-1.pdf
*** Physical Review Letters
See [[file:revtex4-1/PRL/manuscript.org]].
*** Physical Review B
See [[file:revtex4-1/PRB/manuscript.org]].

** Elsevier journals

documentation

 file:../texmf/doc/latex/elsarticle/elsdoc.pdf

see [[file:elsarticle/manuscript.org]] for an example.

** Springer journals
see [[./svjour3/manuscript.org]]

* Bibliography

# <<bibliographystyle>>
bibliographystyle:unsrt

# <<bibliography>>
bibliography:kitchin.bib
